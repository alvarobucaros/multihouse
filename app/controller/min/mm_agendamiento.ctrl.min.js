var app=angular.module("app",[]);app.controller("mainController",["$scope","$http",function(e,a){e.form_title="Agenda reunión",e.form_titleTercero="Actualiza datos del invitado",e.form_btnNuevo="Nuevo registro",e.form_btnEdita="Edita",e.form_btnElimina="Elimina",e.form_btnAnula="Cerrar",e.form_btnActualiza="Actualizar",e.form_btnEnFirme="Dejar en Firme",e.form_btnAnulaRegistro="Cancelar reunión",e.form_btnConfirmar="Confirmar",e.form_btnBuscar="Busca reuniones",e.form_btnCrear="Crea solicitud",e.form_btnCitacion="Enviar citaciones",e.form_tituloP="Presidente",e.form_tituloS="Secretario",e.form_tituloT="Transcriptor",e.form_tituloN="Ninguno",e.form_titModal="Actualiza lista de registros",e.form_asistente_orden="Orden secuencial",e.form_asistente_nombre="Nombre",e.form_asistente_empresa="Empresa",e.form_asistente_cargo="Cargo",e.form_asistente_celular="Tel. celular",e.form_asistente_email="Correo electrónico",e.form_asistente_titulo="Título",e.form_agenda_id="ID",e.form_agenda_empresa="EMPRESA",e.form_agenda_salonId="SALON",e.form_agenda_Descripcion="DETALLE COMITE",e.form_agenda_comiteId="COMITE",e.form_agenda_fechaDesde="FECHA DESDE",e.form_agenda_fechaHasta="FECHA HASTA",e.form_agenda_fechaReserva="FECHA RESERVA",e.form_agenda_hora="HORA",e.form_agenda_reservadoPor="RESERVADO POR",e.form_agenda_comiteAnteriorId="COMITE ANTERIOR",e.form_agenda_comiteCausaAnulacion="CAUSA CANCELACION",e.form_agenda_comiteEnviaCitacion="NOTA AL CORREO DE CITACION",e.form_tema_titulo="TITULO",e.form_tema_detalle="DETALLE",e.form_tema_tipo="TIPO",e.form_tema_responsable="RESPONSABLE",e.form_tema_fechaAsigna="FECHA ASIGNA",e.form_tema_estado="ESTADO",e.form_Activo90="INACTIVO",e.form_Activo91="ACTIVO",e.form_Phagenda_id="Digite id",e.form_Phagenda_empresa="Digite empresa",e.form_Phagenda_salonId="Digite salon",e.form_Phagenda_Descripcion="Digite descripcion",e.form_Phagenda_comiteId="Digite comite",e.form_Phagenda_fechaDesde="Digite fch desde",e.form_Phagenda_fechaHasta="Digite fch hasta",e.form_Phagenda_fechaReserva="Digite fch reserva",e.form_Phagenda_comiteAnteriorId="Digite comite_anterior",e.form_Phagenda_reservadoPor="Quien hace la reserva",e.form_PhcomiteCausaAnulacion="Causa para anular agendamiento",e.form_nuevotema=" Crea nuevo tema ",e.form_nuevoinvitado=" Crea nuevo invitado ",e.form_tema_titulo="Tema",e.form_temag="Tema general",e.form_temap="Tema pendiente",e.modelTab2=!1,e.modelTab3=!1,e.modelTab4=!1,e.modelTab5=!1,e.datosOcultos=!1,e.temaNuevo=!1,e.listaComite=!1,e.btnBusca=!0,e.agenda_salonIdtmp=0,e.agenda_comiteIdtmp=0,e.agenda_agendaIdtmp=0,e.comite_id=0,e.agenda_id=0,e.registro1={},e.registro1={},e.registro3={},e.registro4={},e.registro5={},e.registroTercero={},e.empresa=$("#e").val();var o=(r=new Date).getMonth()+1;fechaHoy=r.getFullYear()+"-"+o+"-"+r.getDate(),e.agenda_fechaDesde=fechaHoy+"T00:00 ",e.agenda_fechaHasta=fechaHoy+"T00:00 ",fechaHoy+="T"+r.getHours()+":"+r.getMinutes()+" ";var t,r=new Date;function i(o){a.post("modulos/mod_mm_agendamiento.php?op=ti",{op:"ti",agenda_id:o,empresa:e.empresa}).success(function(a){"No Hay"!=a&&(e.detailAsistes=a)})}function n(o){a.post("modulos/mod_mm_agendamiento.php?op=tt",{op:"tt",agenda_id:o,empresa:e.empresa}).success(function(a){"No Hay"!=a&&(e.detail4s=a)})}e.registro1.agenda_fechaReserva=fechaHoy,t=e.empresa,a.post("modulos/mod_mm_agendamiento.php?op=0",{op:"0",empresa:t}).success(function(a){e.operators0=a}),a.post("modulos/mod_mm_agendamiento.php?op=1",{op:"1",empresa:t}).success(function(a){e.operators1=a}),a.post("modulos/mod_mm_agendamiento.php?op=hr",{op:"hr",empresaId:t}).success(function(a){e.operatorshd=a}),function(){r=new Date,d="",r.getDate()<"10"&&(d="0");d+=r.getDate(),m="",r.getMonth()+1<"10"&&(m="0");m+=r.getMonth()+1;var a=d+"/"+m+"/"+r.getFullYear(),o=$("#my-name").text(),t=$("#e").val(),i=$("#u").val();e.registro1.agenda_reservadoPor=o,e.registro1.agenda_fechaDesde=a,e.registro1.agenda_fechaHasta=a,e.registro1.agenda_empresa=t,e.registro4.tema_empresa=t,e.registro1.agenda_usuario=i,$("#agenda_fechaDesde").val(r)}(),e.buscaRegistros=function(){e.listaComite=!1,a.post("modulos/mod_mm_agendamiento.php?op=2",{op:"2",comite_id:e.agenda_comiteIdtmp}).success(function(a){e.operators2=a,e.listaComite=!0})},e.traeComiteLista=function(){e.agendaId=e.registro1.agenda_agendaId,empresa=$("#e").val(),a.post("modulos/mod_mm_agendamiento.php?op=lur",{op:"lur",agenda_id:e.registro1.agenda_agendaId,empresa:empresa}).success(function(a){rec=a.split("||"),e.registro1.agenda_empresa=rec[0],e.registro1.agenda_salonId=rec[1],e.registro1.agenda_Descripcion=rec[2],e.registro1.agenda_comiteId=rec[3],e.comite_id=rec[3],tm=rec[4].split(" "),e.registro1.agenda_fechaDesde=tm[0],e.registro1.agenda_horaDesde=tm[1].substr(0,5),tm=rec[5].split(" "),e.registro1.agenda_fechaHasta=tm[0],e.registro1.agenda_horaHasta=tm[1].substr(0,5),e.registro1.agenda_comiteAnteriorId=rec[6],e.registro1.agenda_usuario=rec[7],e.registro1.agenda_enFirme=rec[8],e.registro1.agenda_conCitacion=rec[9],e.registro1.comite_id=rec[13],e.agenda_id=rec[13],e.agenda_Descripcion=rec[2],e.comite_nombreResul=rec[12],e.salon_nombreResul=rec[11],e.agenda_id=rec[13],e.modelTab3=!0,e.modelTab4=!0,e.modelTab5=!0,e.btnBusca=!1,e.registro5.agenda_Id=e.registro1.agenda_agendaId,i(e.agendaId),n(e.agendaId)})},e.deleteDetailAsiste=function(o){if(confirm("Desea borrar el registro con nombre : "+o.invitado_nombre+" ?")){var t=o.invitado_id;a.post("modulos/mod_mm_agendamiento.php?op=dtl",{op:"dtl",invitado_id:t}).success(function(a){"Ok"===a&&(i(e.registro1.agenda_agendaId),alert("Registro Borrado "))})}},e.editDetailAsiste=function(a){e.terceroForm=!0;var o=a.invitado_titulo;e.form_titleTercero="Modifica datos del participante : "+a.invitado_nombre,e.registroTercero.asistente_nombre=a.invitado_nombre,e.registroTercero.asistente_cargo=a.invitado_cargo,e.registroTercero.asistente_empresa=a.invitado_empresa,e.registroTercero.asistente_celular=a.invitado_celuar,e.registroTercero.asistente_email=a.invitado_email,e.registroTercero.asistente_titulo=o.substring(0,1),e.registroTercero.asistente_orden=a.invitado_orden,e.registroTercero.asistente_id=a.invitado_id,e.registro1.invitado_id=a.invitado_id},e.updateInfoTercero=function(o){var t=e.registro1.agenda_comiteId+"||"+e.registroTercero.asistente_nombre+"||"+e.registroTercero.asistente_cargo;t+="||"+e.registroTercero.asistente_empresa+"||N||",t+=e.registroTercero.asistente_titulo+"|| ||",t+=e.registroTercero.asistente_id+"||"+e.registroTercero.asistente_orden+"||"+e.agenda_id+"||",t+=e.registroTercero.asistente_celular+"||"+e.registroTercero.asistente_email+"||",t+=e.registro1.invitado_id+"||"+e.registroTercero.asistente_titulo,a.post("modulos/mod_mm_agendamiento.php?op=ctl",{op:"ctl",datos:t}).success(function(a){"Ok"===a&&(i(e.agenda_id),e.registroTercero={},e.terceroForm=!1,e.registro1.invitado_id=0,e.registroTercero.asistente_titulo=" ",alert("Registro actualizado "))})},e.createNuevoInvitado=function(o){e.registroTercero={},e.terceroForm=!0,e.registro1.invitado_id=0,e.registroTercero.asistente_titulo=" ",e.form_titleTercero="Adiciona datos de participante ",a.post("modulos/mod_mm_agendamiento.php?op=sel",{op:"sel",agenda_id:e.agenda_id,opc:"I"}).success(function(a){e.registroTercero.asistente_orden=a})},e.clearInfoTercero=function(){e.terceroForm=!1,e.registroTercero={}},e.creaSolicitud=function(o){er="",""===$("#agenda_comiteId").val()&&(er+="falta comite\n"),""===$("#agenda_Descripcion").val()&&(er+="falta detalle de comité (tab Comité)\n");e.agenda_salonId;var t=e.agenda_horaDesde,r=e.agenda_horaHasta;isNaN(e.registro1.agenda_salonId)&&(er+="falta salón\n"),""===$("#agenda_fechaDesde").val()&&(er+="falta fecha desde\n"),""===t&&(er+="falta hora desde\n"),""===$("#agenda_fechaHasta").val()&&(er+="falta fecha hasta\n"),""===r&&(er+="falta hora hasta\n"),""===$("#agenda_fechaReserva").val()&&(er+="falta fecha reservación\n"),""===$("#agenda_reservadoPor").val()&&(er+="falta quien reserva\n"),""===$("#agenda_comiteAnteriorId").val()&&(er+="falta número comité anterior\n"),void 0!==e.registro1.agenda_horaDesde&&void 0!==e.registro1.agenda_horaHasta||(er+="Revizar hora desde y hora hasta\n"),""==er?(e.agenda_agendaIdtmp=0,dato=e.agenda_comiteIdtmp+"||"+e.registro1.agenda_Descripcion+"||",dato+=e.registro1.agenda_comiteAnteriorId+"||",dato+=e.registro1.agenda_empresa+"||"+e.agenda_agendaIdtmp+"||",dato+=e.registro1.agenda_fechaDesde+"||"+e.registro1.agenda_fechaHasta+"||",dato+=e.registro1.agenda_horaDesde+"||"+e.registro1.agenda_horaHasta+"||",dato+=e.registro1.agenda_salonId+"||"+e.registro1.agenda_usuario,a.post("modulos/mod_mm_agendamiento.php?op=a",{op:"a",dato:dato}).success(function(a){rec=a.split("||"),"Ok"===rec[0]&&(e.agenda_agendaIdtmp=rec[1],e.agenda_id=rec[1],e.registro1.agenda_id=rec[1],n(e.agenda_id),i(e.agenda_id),alert("Solicitud creada. Incluya invitados y temas a tratar, actualice en confirmar "),e.modelTab3=!0,e.modelTab4=!0,e.modelTab5=!0)})):alert(er)},e.createNuevoTema=function(){e.temaNuevo=!0,e.registro4={},e.registro4.tema_tipo="G",e.registro4.tema_estado="A",e.registro4.tema_id=0,e.registro4.tema_empresa=$("#e").val(),e.registro4.tema_comite=e.comite_id,e.registro4.tema_agendaId=e.registro1.agenda_id,e.registro5.agenda_Id=e.registro1.agenda_id,a.post("modulos/mod_mm_agendamiento.php?op=sel",{op:"sel",agenda_id:e.agenda_id,opc:"T"}).success(function(a){e.registro4.tema_orden=a})},e.cierraTema=function(){e.temaNuevo=!1,e.registro4={}},e.editTema=function(a){var o=a.tema_tipo;e.registro4.tema_titulo=a.tema_titulo,e.registro4.tema_detalle=a.tema_detalle,e.registro4.tema_responsable=a.tema_responsable,e.registro4.tema_tipo=o.substring(0,1),e.registro4.tema_fechaAsigna=a.tema_fechaAsigna,e.registro4.tema_estado=a.tema_estado,e.registro4.tema_id=a.tema_id,e.registro4.tema_agendaId=a.tema_agendaId,e.registro4.tema_empresa=a.tema_empresa,e.registro4.tema_comite=a.tema_comite,e.registro4.tema_orden=a.tema_orden,e.temaNuevo=!0},e.updateTema=function(o){var t=e.registro4.tema_id+"||"+e.agenda_id+"||"+e.empresa+"||"+e.registro1.agenda_comiteId+"||"+e.registro4.tema_titulo+"||"+e.registro4.tema_detalle+"||"+e.registro4.tema_tipo+"||"+e.registro4.tema_responsable+"|| ||"+e.registro4.tema_fechaAsigna+"|| ||"+e.registro4.tema_estado+"||0||"+e.registro4.tema_orden;a.post("modulos/mod_mm_agendamiento.php?op=atm",{op:"atm",datos:t}).success(function(a){"Ok"===a&&(n(e.agenda_id),e.temaNuevo=!1,alert("tema actualizado "))})},e.updateComite=function(){empresa=e.empresa,e.btnBuscaReg=!1,e.listaComite=!1,a.post("modulos/mod_mm_agendamiento.php?op=nc",{op:"nc",comiteId:e.registro1.agenda_comiteId,empresa:empresa}).success(function(a){$rec=a.split("||"),e.comite_nombreResul=$rec[0],e.registro1.agenda_comiteAnteriorId=$rec[1],e.agenda_comiteIdtmp=$rec[2],e.comite_id=$rec[2],0!=$rec[3]&&(e.btnBuscaReg=!0,e.listaComite=!0)}),e.modelTab2=!0,e.tema_comite=e.comite_nombreResul},e.updateComiteDescri=function(){detalle=e.registro1.agenda_Descripcion,e.agenda_Descripcion=detalle,e.modelTab2=!0},e.updateSalon=function(){e.agenda_salonIdtmp=e.registro1.agenda_salonId,a.post("modulos/mod_mm_agendamiento.php?op=ns",{op:"ns",salonId:e.registro1.agenda_salonId}).success(function(a){e.salon_nombreResul=a})},e.formAnula=function(){alert("anula")},e.anulaRegistro=function(){nota=e.comite_nombreResul+" - "+e.agenda_Descripcion,confirm("Esto anulará el agendamiento del comité : "+nota+" continúa ?")&&(e.anula=!0)},e.vaAnularRegistro=function(o){datos=e.registro5.agenda_Id+"||"+e.registro5.agenda_comiteCausaAnulacion+"||I||Anula",a.post("modulos/mod_mm_agendamiento.php?op=ara",{op:"ara",datos:datos}).success(function(a){rec=a.split("||"),"Ok"===rec[0]&&(e.modelTab3=!1,e.modelTab4=!1,e.modelTab5=!1,e.listaComite=!1,e.registro1={},alert(rec[1]))})},e.vaAcitarRegistro=function(o){e.enviaImg=!0,datos=e.registro5.agenda_Id+"||"+e.registro5.agenda_comiteNotaCitacion,a.post("modulos/mod_mm_contacto.php?op=eic",{op:"eic",dato:datos}).success(function(a){rec=a.split("||"),"Ok"===rec[0]?e.registro5.respuestaMail="Se han enviado "+rec[1]+"citaciones":alert(a)}),e.enviaImg=!1,e.enviaMail=!1},e.haceCitacion=function(){e.anula=!1,confirm("Deja en firme esta invitación, Envia citaciones a las personas invitadas, al mensaje del correo se le puede adicionar un mensaje ")&&(e.enviaMail=!0,e.registro5.agenda_comiteNotaCitacion="Citación comité "+e.registro1.agenda_Descripcion)},e.quedaEnFirme=function(){e.anula=!1},e.registro=function(e){alert("inserta")},e.registro=function(o){alert("actualiza"),a.post("modulos/mod_mm_agendamiento.php?op=a",{op:"a",agenda_id:agenda_id,agenda_empresa:e.agenda_empresa,agenda_salonId:agenda_salonId,agenda_Descripcion:e.agenda_Descripcion,agenda_comiteId:agenda_comiteId,agenda_fechaDesde:agenda_fechaDesde,agenda_fechaHasta:agenda_fechaHasta,agenda_comiteAnteriorId:e.agenda_comiteAnteriorId}).success(function(a){e.show_form=!0,alert(a)})},e.registro={},e.editInfo=function(a){e.registro=a,$("#idForm1").slideToggle()},e.deleteInfo=function(e){confirm("Desea borrar el registro con nombre : "+e.agenda_empresa+" ?")&&a.post("modulos/mod_mm_agendamiento.php?op=b",{op:"b",agenda_id:e.agenda_id}).success(function(e){"Ok"===e&&alert("Registro Borrado ")})},e.agenda_fechaDesde=function(){e.registro1.agenda_fechaHasta=e.registro1.agenda_fechaDesde},e.updateInfo=function(e){er="",""===$("#agenda_id").val()&&(er+="falta id\n"),""===$("#agenda_empresa").val()&&(er+="falta empresa\n"),""===$("#agenda_salonId").val()&&(er+="falta salon\n"),""===$("#agenda_Descripcion").val()&&(er+="falta descripcion\n"),""===$("#agenda_comiteId").val()&&(er+="falta comite\n"),""===$("#agenda_fechaDesde").val()&&(er+="falta fch_desde\n"),""===$("#agenda_fechaHasta").val()&&(er+="falta fch_hasta\n"),""===$("#agenda_comiteAnteriorId").val()&&(er+="falta comite_anterior\n"),""===er?a.post("modulos/mod_mm_agendamiento.php?op=a",{op:"a",agenda_id:e.agenda_id,agenda_empresa:e.agenda_empresa,agenda_salonId:e.agenda_salonId,agenda_Descripcion:e.agenda_Descripcion,agenda_comiteId:e.agenda_comiteId,agenda_fechaDesde:e.agenda_fechaDesde,agenda_fechaHasta:e.agenda_fechaHasta,agenda_comiteAnteriorId:e.agenda_comiteAnteriorId}).success(function(e){"Ok"===e&&(alert("Registro Actualizado "),$("#idForm1").slideToggle())}):alert(er)},e.clearInfo=function(e){console.log("empty"),$("#idForm1").slideToggle()}}]);